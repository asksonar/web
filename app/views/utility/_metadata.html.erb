<script type='text/javascript'>
  window.sonar = {};

  sonar.request = {
    controller: '<%= request.params[:controller] %>',
    action: '<%= request.params[:action] %>'
  };

  <% if current_researcher %>
  sonar.user = {
    hashid: '<%= current_researcher.hashid %>'
  };
  <% end %>

  <% if @scenario %>
  sonar.scenario = {
    title: '<%= @scenario.prezi.title %>',
    description: '<%= @scenario.prezi.title %>',
    steps: <%= raw @scenario.prezi.scenario_steps_array.to_json %>
  };
  <% end %>

  <% if @template %>
  sonar.template = {
    title: '<%= @scenario.prezi.title %>',
    description: '<%= @scenario.prezi.title %>',
    steps: <%= raw @template.prezi.template_steps_array.to_json %>
  };
  <% end %>

  <% if @result_step %>
  sonar.resultStep = {
    hashid: '<%= @result_step.prezi.hashid %>',
    delightedArray: <%= raw @result_step.prezi.delighted_array.to_json %>,
    confusedArray: <%= raw @result_step.prezi.confused_array.to_json %>,
    highlightedArray: <%= raw @result_step.prezi.highlighted_array.to_json %>,
    srcArray: <%= raw @result_step.prezi.src_array.to_json %>,
    transcriptionArray: <%= raw @result_step.prezi.transcription_array.to_json %>,
    shareLink: '<%= @result_step.prezi.share_link %>',
    email: '<%= @result_step.prezi.email %>'
  };
  <% end %>

  <% if @scenario_step %>
  sonar.scenarioStep = {
    stepOrder: <%= @scenario_step.prezi.step_order %>,
    stepDescription: '<%= @scenario_step.prezi.description %>'
  };
  <% end %>

  <% if protect_against_forgery? %>
    window.AUTH_TOKEN = '<%= form_authenticity_token %>';
  <% end %>

</script>

<%= bootstrap_form_for @scenario, url: @scenario.id ? draft_path(@scenario) : drafts_path, html: {id: 'create-form'} do |f| %>
<div class='pageheader'>
  <h1>
    <% if @scenario.id %>
      Edit your scenario&nbsp;&nbsp;<small>last updated <%= time_ago_in_words(@scenario.updated_at) %> ago</small>
    <% else %>
      Create a new scenario
    <% end %>
  </h1>
  <div class='row ctn-input-title'>
    <div class='col-xs-11'>
      <%= f.text_field :title, hide_label: true, placeholder: 'Give your scenario a title (only visible to you)' %>
    </div>
    <div class='col-xs-1'>
      <div class="btn-group pull-right">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
          Templates <span class="caret"></span>
        </button>
        <ul class="dropdown-menu dropdown-menu-right" role="menu">
          <% @product_templates.each do |template| %>
            <li><a href='?template=<%=template.value%>'><%=template.display%></a></li>
          <% end %>
          <li class="divider"></li>
          <% @marketing_templates.each do |template| %>
            <li><a href='?template=<%=template.value%>'><%=template.display%></a></li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</div>
<section id="main-content">
  <%= f.hidden_field :id, value: @scenario.id %> <!-- #to_param -->
  <div class='row'><div class='col-md-12 col-lg-10 col-lg-offset-1'><div class='panel panel-default'>
    <div class='panel-body'>

      <div class='row ctn-scenario-description'>
        <div class='col-xs-2'>
          <div class='ctn-left-description'>Summary</div>
        </div>
        <div class='col-xs-9'>
          <%= f.text_area :description, rows: 3, hide_label: true, placeholder: 'Describe for your user what the scenario is about' %>
        </div>
      </div>

      <script id="new-step-template" type="text/x-handlebars-template">
        {{#each steps}}
        <div class='row ctn-step'>
          <%= f.hidden_field :id, value: '{{id}}', name: 'scenario_steps[][id]' %>
          <div class='col-xs-2'>
            <div class='ctn-step-count ctn-left-description'>Step 1.</div>
          </div>
          <div class='col-xs-6 ctn-step-input'>
            <%= f.text_area :description, hide_label: true, rows: 1, placeholder: 'Tell your user what to do next', value: '{{description}}', name: 'scenario_steps[][description]' %>
          </div>
          <div class='col-xs-3 ctn-step-input-url'>
            <%= f.text_field :url, hide_label: true, placeholder: 'URL (optional)', value: '{{url}}', name: 'scenario_steps[][url]' %>
          </div>
          <div class='col-xs-1'>
            <div class='ctn-step-btn'>
              <i class='btn-add-step fa fa-plus-circle'></i>
              <i class='btn-remove-step fa fa-times-circle'></i>
            </div>
          </div>
        </div>
        {{/each}}
      </script>

      <script type='text/javascript'>
        var scenarioSteps = <%= raw @scenario.scenario_steps_json %>;
      </script>

      <div id='ctn-step-list'><!-- insert new steps here -->
      </div>

    </div>
    <div class='panel-footer text-center ctn-save-buttons'>
      <%= f.submit 'Save Draft', name: 'draft', class: 'btn btn-info' %>
      <%= f.submit 'Create', name: 'publish', class: 'btn btn-success' %>
      <a href='<%=results_path%>' class='btn btn-default'>Cancel</a>
    </div>
  </div></div></div>
</section>
<% end %>

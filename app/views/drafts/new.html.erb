<% content_for :title do %>
  <% if @scenario.id %>
  Edit Study
  <% else %>
  New Study
  <% end %>
<% end %>

<%= bootstrap_form_for @scenario, url: @scenario.id ? draft_path(@scenario) : drafts_path, html: {id: 'create-form', class: ('draft-editable-steps' if @scenario.can_add_steps?) } do |f| %>
  <%= f.hidden_field :id, value: @scenario.id %>
  <%= f.hidden_field :template, value: params[:template] %>

  <section class='main-content-header draft-header'>
    <div class='row'>
      <div class='ctn-title'>
        <h1>
          <%= f.text_field :title, hide_label: true, placeholder: 'Title your study', class: 'input-lg' %>
        </h1>
        <p class='sub'>
          This title is so you can tell your studies apart internally. Your respondents will never see this.
        </p>
      </div>

      <div class='ctn-template'>
        <div class="btn-group" id='btn-template-group'>
          <a class="btn btn-light-blue dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
            Start from a template<span class="caret"></span>
          </a>
          <ul class="dropdown-menu dropdown-menu-right" role="menu">
            <% @product_templates.each do |template| %>
              <li><a href='?template=<%=template.value%>'><%=template.display%></a></li>
            <% end %>
            <li class="divider"></li>
            <% @marketing_templates.each do |template| %>
              <li><a href='?template=<%=template.value%>'><%=template.display%></a></li>
            <% end %>
          </ul>
        </div>
        <p>or just start typing below.</p>
      </div>
    </div>

  </section>
  <section class="main-content draft-content">

    <div class='panel'>

      <div class='summary-container'>
        <p class='sub'>
          This description gives context and explains to your respondents the overall purpose of your study.
        </p>
        <%= f.text_area :description, rows: 3, hide_label: true, placeholder: 'Welcome the panelist to the study' %>
      </div>

      <div class='steps-container'>
        <p class='sub'>
          Tell your respondents what you’d like them to do, step by step. Sonar will record their screen and voice as they talk their way through your steps.
        </p>
        <div id='ctn-step-list'><!-- insert new steps here --></div>
      </div>

      <div class='clearfix buttons-container'>
        <a href='<%=results_path%>' class='btn btn-grey pull-left'>Cancel</a>

        <% if @scenario.drafts? %>
          <%= f.submit 'Create study', name: 'publish', class: 'btn btn-dark-blue pull-right' %>
          <%= f.submit 'Save as draft', name: 'draft', class: 'btn btn-light-blue pull-right' %>
        <% else %>
          <%= f.submit 'Update study', name: 'update', class: 'btn btn-dark-blue pull-right' %>
        <% end %>
        <p class='sub pull-right'>
          Once the study is created, you’ll be able to share the study link with potential respondents.
        </p>
      </div>

    </div>
  </section>


  <script id="new-step-template" type="text/x-handlebars-template">
    {{#each steps}}
    <div class='row ctn-step'>
      <div class='col-xs-8'>
        <h1 class='ctn-count'>1.</h1>
        <div class='ctn-description'>
          <%= f.text_area :description, hide_label: true, rows: 1, placeholder: 'Tell the panelist what to do', value: '{{description}}', name: 'scenario_steps[][description]' %>
        </div>
      </div>
      <div class='col-xs-4 ctn-url-btns'>
        <div class='ctn-btns'>
          <a class='btn btn-add-step btn-light-blue'><span>+</span</a>
          <a class='btn btn-remove-step btn-grey'><span>x</span></a>
        </div>
        <div class='ctn-url'>
          <%= f.text_field :url, hide_label: true, placeholder: 'URL (optional)', value: '{{url}}', name: 'scenario_steps[][url]' %>
        </div>
      </div>
    </div>
    {{/each}}
  </script>

<% end %>
  <script type='text/javascript'>
    var scenarioSteps = <%= raw @scenario.scenario_steps_json %>;
  </script>

